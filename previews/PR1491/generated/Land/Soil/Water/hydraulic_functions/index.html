<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hydraulic Functions · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../../assets/documenter.js"></script><script src="../../../../../siteinfo.js"></script><script src="../../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../../"><img src="../../../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Installation/">Installation</a></li><li><a class="tocitem" href="../../../../../GettingStarted/RunningClimateMachine/">Running</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Defaults</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../GettingStarted/Atmos/">Atmosphere model configurations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Ocean</span></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Heat/heat_equation/">Heat Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Hydraulic Functions</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Multiple-dispatch"><span>Multiple dispatch</span></a></li></ul></li><li><a class="tocitem" href="../../Heat/bonan_heat_tutorial/">Soil Heat Equation</a></li><li><a class="tocitem" href="../../Coupled/equilibrium_test/">Coupled Water and Heat</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Common/Thermodynamics/">Thermodynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Atmos/TemperatureProfiles/">TemperatureProfiles</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-4-5-2" type="checkbox"/><label class="tocitem" for="menuitem-4-5-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/DGMethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-3" type="checkbox"/><label class="tocitem" for="menuitem-4-5-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5-4" type="checkbox"/><label class="tocitem" for="menuitem-4-5-4"><span class="docs-label">System Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../HowToGuides/Numerics/SystemSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/">Home</a></li><li><a class="tocitem" href="../../../../../APIs/Driver/">Driver</a></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../../APIs/Atmos/TemperatureProfiles/">Temperature Profiles</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Ocean/Ocean/">Ocean</a></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Land/LandModel/">Land Model</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilWaterParameterizations/">Soil Water Parameterizations</a></li><li><a class="tocitem" href="../../../../../APIs/Land/SoilHeatParameterizations/">Soil Heat Parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Common/Orientations/">Orientations</a></li><li><a class="tocitem" href="../../../../../APIs/Common/Spectra/">Spectra</a></li><li><a class="tocitem" href="../../../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li><li><a class="tocitem" href="../../../../../APIs/Common/Thermodynamics/">Thermodynamics</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceClosures/">Turbulence Closures</a></li><li><a class="tocitem" href="../../../../../APIs/Common/TurbulenceConvection/">Turbulence Convection</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Balance Laws</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/BalanceLaws/">Balance Laws</a></li><li><a class="tocitem" href="../../../../../APIs/BalanceLaws/Problems/">Problems</a></li></ul></li><li><a class="tocitem" href="../../../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-5-9" type="checkbox"/><label class="tocitem" for="menuitem-5-9"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Diagnostics/Diagnostics/">Diagnostics groups</a></li><li><a class="tocitem" href="../../../../../APIs/Diagnostics/StateCheck/">State Check</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-10" type="checkbox"/><label class="tocitem" for="menuitem-5-10"><span class="docs-label">Input/Output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-11" type="checkbox"/><label class="tocitem" for="menuitem-5-11"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/SystemSolvers/SystemSolvers/">SystemSolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/DGMethods/">DG Methods</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/Courant/">Courant</a></li><li><a class="tocitem" href="../../../../../APIs/Numerics/DGMethods/NumericalFluxes/">Numerical Fluxes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-12" type="checkbox"/><label class="tocitem" for="menuitem-5-12"><span class="docs-label">Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../APIs/Utilities/VariableTemplates/">Variable Templates</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/SingleStackUtils/">Single Stack Utilities</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/Checkpoint/">Checkpoint</a></li><li><a class="tocitem" href="../../../../../APIs/Utilities/TicToc/">Tic Toc</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-7-1" type="checkbox"/><label class="tocitem" for="menuitem-7-1"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../../../Theory/Common/Turbulence/">Turbulence Closures</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../Theory/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/EDMFEquations/">EDMF equations</a></li><li><a class="tocitem" href="../../../../../Theory/Atmos/Model/tracers/">Tracers</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../../DevDocs/CodeStyle/">Coding style</a></li><li><a class="tocitem" href="../../../../../DevDocs/AcceptableUnicode/">Acceptable Unicode</a></li><li><a class="tocitem" href="../../../../../DevDocs/VariableList/">Variable list</a></li><li><a class="tocitem" href="../../../../../DevDocs/DiagnosticVariables/">Diagnostic variable list</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Land</a></li><li><a class="is-disabled">Soil</a></li><li class="is-active"><a href>Hydraulic Functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hydraulic Functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/tutorials/Land/Soil/Water/hydraulic_functions.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Hydraulic-functions"><a class="docs-heading-anchor" href="#Hydraulic-functions">Hydraulic functions</a><a id="Hydraulic-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Hydraulic-functions" title="Permalink"></a></h1><p>This tutorial shows how to specify the hydraulic functions used in Richard&#39;s equation. In particular, we show how to choose the formalism for matric potential and hydraulic conductivity, and how to make the hydraulic conductivity account for the presence of ice as well as the temperature dependence of the viscosity of liquid water.</p><h1 id="Multiple-dispatch"><a class="docs-heading-anchor" href="#Multiple-dispatch">Multiple dispatch</a><a id="Multiple-dispatch-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-dispatch" title="Permalink"></a></h1><p>Before diving into the hydraulics, let&#39;s go over a feature of Julia called multiple dispatch. This will make things simpler moving forwards!</p><p>In the Climate Machine code, we make use of multiple dispatch. With multiple dispatch, a function can have many ways of executing (called methods), depending on the <em>type</em> of the variables passed in. A simple example of multiple dispatch is the division operation. Integer division takes two numbers as input, and returns an integer - ignoring the decimal. Float division takes two numbers as input, and returns a floating point number, including the decimal. In Julia, we might write these as:</p><pre><code class="language-none">   function division(a::Int, b::Int)
        return floor(Int, a/b)
    end

   function division(a::Float64, b::Float64)
        return a/b
    end
 ```
We can see that `division` is now a function with two methods.</code></pre><pre><code class="language-none">julia&gt; division
division (generic function with 2 methods)</code></pre><pre><code class="language-none">Now, using the same function signature, we can carry out integer
division or floating point division, depending on the types of the
arguments:</code></pre><pre><code class="language-none">julia&gt; division(1,2)
0

julia&gt; division(1.0,2.0)
0.5</code></pre><pre><code class="language-none">
One benefit of this is that a function like `matric_potential`, which
should return different answers depending on what type of hydraulics
model (e.g. van Genchten, or Brooks and Corey) the user chooses,
is always called in the same way. If not, we would need to have a
`matric_potential_van_genuchten` function, and a `matric_potential_brooks_and_corey`
function, for example, and we would need to change the source code
whenever the user wished to changed hydraulics model. Or, we could
have a single function with a branch in it, (the choice made based on a flag passed in),
but this slows things down on the GPU.
Multiple dispatch provides a nice solution.

# Preliminary setup

- load external packages
</code></pre><p>@example hydraulic_functions using Plots</p><pre><code class="language-none">
- load ClimateMachine modules
</code></pre><p>@example hydraulic_functions using ClimateMachine using ClimateMachine.Land using ClimateMachine.Land.SoilWaterParameterizations</p><p>FT = Float32</p><pre><code class="language-none">
# Choose general soil parameters for your soil type.
For the water equation, the user needs to choose a porosity `ν`,
saturated hydraulic conductivity `Ksat` (and a specific storage `S_s`,
though that is not needed here).
Note that the two hydraulic models included in ClimateMachine -
that of Brooks and Corey (1964, 1977) and van Genuchten (1980) - use the same
value of `Ksat`. All values are given in SI/mks units. We
neglect the residual pore space in the ClimateMachine model. Below
we choose parameters for sandy loam (Bonan, 2019, Chapter 8, page 120).
</code></pre><p>@example hydraulic_functions ν = FT(0.41) Ksat = FT(4.42 / (3600 * 100))</p><pre><code class="language-none">
# Matric Potential
The matric potential represents how much water clings to soil. Drier soil
holds onto water more tightly, making diffusion more difficult. As soil becomes
wetter, the matric potential decreases in magnitude, making diffusion easier.
ClimateMachine&#39;s Land model allows for two `hydraulics` models for matric potential
(and hydraulic conductivity), that of van Genuchten (1980), and Brooks and Corey (1967, 1970).

The van Genucthen model requires two free parameters, `α` and `n`.
The third parameter is computed from `n`. Of these, only `α` carries
units, of inverse meters. The Brooks and Corey model also uses
two free parameters, `ψ_b`, the matric potential at saturation,
 and a constant `m`. `ψ_b` carries units of meters.

Below we show how to create two concrete examples of these hydraulics models,
for sandy loam. Importantly - the parameters chosen are a function of soil type!
</code></pre><p>@example hydraulic<em>functions vg</em>α = FT(7.5) vg<em>n = FT(1.89) hydraulics = vanGenuchten{FT}(α = vg</em>α, n = vg_n)</p><p>ψ<em>sat = 0.09 mval = 0.228 hydraulics</em>bc = BrooksCorey{FT}(ψb = ψ_sat, m = mval)</p><pre><code class="language-none">
As alluded to above, we use multiple dispatch.
As a concrete example:
`hydraulics` is of type vanGenuchten{Float32} based on our choice of FT:</code></pre><pre><code class="language-none">julia&gt; typeof(hydraulics)
vanGenuchten{Float32}</code></pre><pre><code class="language-none">but meanwhile,</code></pre><pre><code class="language-none">julia&gt; typeof(hydraulics_bc)
BrooksCorey{Float32}</code></pre><pre><code class="language-none">The function `matric_potential` will execute different methods
depending on if we pass a hydraulics model of type vanGenuchten or
e.g. BrooksCorey! In both cases, it will return the correct value
for `ψ`.

Let&#39;s plot the matric potential as a function of the effective saturation `S_l`.
</code></pre><p>@example hydraulic<em>functions S</em>l = FT.(0.01:0.01:0.99) ψ = matric<em>potential.(Ref(hydraulics), S</em>l) ψ<em>bc = matric</em>potential.(Ref(hydraulics<em>bc), S</em>l) plot(     S<em>l,     log10.(-ψ),     xlabel = &quot;effective saturation&quot;,     ylabel = &quot;Log10(|ψ|)&quot;,     label = &quot;van Genuchten&quot;, ) plot!(S</em>l, log10.(-ψ<em>bc), label = &quot;Brooks and Corey&quot;) savefig(&quot;./bc</em>vg<em>matric</em>potential.png&quot;)</p><pre><code class="language-none">
![](bc_vg_matric_potential.png)
The huge range in `ψ` as `S_l` varies, as well as the steep slope in
`ψ` near saturation and completely dry soil, are part of the reason
why Richard&#39;s equation is such a challenging numerical problem.

# Hydraulic conductivity
The hydraulic conductivity is a more complex function than the matric potential,
as it depends on the temperature of the water, the volumetric ice fraction, and
the volumetric liquid water fraction. It also depends on the `hydraulics` model
chosen.

We represent the hydraulic conductivity `K` as the product of four factors:
`Ksat`, an `impedance_factor` (which accounts for the effect of ice)
a `viscosity_factor` (which accounts for the effect of temperature)
and a `moisture_factor` (which accounts for the effect of liquid water),
 Let&#39;s start with ice and temperature independence, but moisture dependence.
The `moisture_factor` will make use of the `hydraulics` model chosen above when we compute `K`.
</code></pre><p>@example hydraulic<em>functions moisture</em>choice = MoistureDependent{FT}() viscosity<em>choice = ConstantViscosity{FT}() impedance</em>choice = NoImpedance{FT}()</p><pre><code class="language-none">
We are going to calculate `K = Ksat × 1 × 1 × moisture_factor`, but as alluded
to above, our functions will use multiple dispatch. Just like we defined new type
classes for vanGenuchten{FT} and BrooksCorey{FT}, we also created new type classes
for the `impedance_factor`, `viscosity_factor`, and `moisture_factor`.
Based on the type choices the user makes for these, the correct conductivity
value will be returned. For example, in the source code we have defined a function
called `viscosity_factor` with a method that, when passed `ConstantViscosity{FT}`, always
returns 1. The same is true for a method of `impedance_factor`, using the type
`NoImpedance{FT}`, and for `moisture_factor`, using the type `MoistureIndependent{FT}`.

One byproduct of this flexibility in functions is that `hydraulic_conductivity`
requires all the arguments it could possibly need passed to it, which is
why here we must supply a value `T` and `θ_ice`, even though they are not used.
</code></pre><p>@example hydraulic<em>functions T = FT(0.0) θ</em>ice = FT(0.0)</p><p>K =     Ksat .*     hydraulic<em>conductivity.(         Ref(impedance</em>choice),         Ref(viscosity<em>choice),         Ref(moisture</em>choice),         Ref(hydraulics),         Ref(θ<em>ice),         Ref(ν),         Ref(T),         S</em>l,     )</p><pre><code class="language-none">
Let&#39;s see how the curves change when we include the effects of temperature
and ice on the hydraulic conductivity.
</code></pre><p>@example hydraulic<em>functions viscosity</em>choice<em>T = TemperatureDependentViscosity{FT}() T = FT(300.0) K</em>T =     Ksat .*     hydraulic<em>conductivity.(         Ref(impedance</em>choice),         Ref(viscosity<em>choice</em>T),         Ref(moisture<em>choice),         Ref(hydraulics),         Ref(θ</em>ice),         Ref(ν),         Ref(T),         S<em>l,     ) ice</em>impedance<em>I = IceImpedance{FT}() θ</em>ice = FT(0.3) S<em>l</em>accounting<em>for</em>ice = FT.(0.01:0.01:0.7) # note that the total volumetric water fraction cannot exceed unity. K<em>ice =     Ksat .*     hydraulic</em>conductivity.(         Ref(ice<em>impedance</em>I),         Ref(viscosity<em>choice),         Ref(moisture</em>choice),         Ref(hydraulics),         Ref(θ<em>ice),         Ref(ν),         Ref(T),         S</em>l<em>accounting</em>for<em>ice,     ) plot(     S</em>l,     log10.(K),     xlabel = &quot;effective saturation&quot;,     ylabel = &quot;Log10(K)&quot;,     label = &quot;Base case&quot;, ) plot!(S<em>l, log10.(K</em>T), label = &quot;Temperature Dependent Viscosity&quot;) plot!(S<em>l</em>accounting<em>for</em>ice, log10.(K<em>ice), label = &quot;Ice Impedance&quot;) savefig(&quot;./T</em>ice_K.png&quot;)</p><pre><code class="language-none">
![](T_ice_K.png)
A word about ice - if the user is not considering phase transitions
and does not add in Freeze/Thaw source terms, the default is for zero
ice in the model, for all time and space. The ice impedance factor is
one if the volumetric ice fraction is zero, so even if one chose
`IceImpedance{FT}` as the `impedance_factor`, without freezing and thawing,
this factor would still be unity.

We can also look and see how the Brooks and Corey moisture factor differs from the
van Genuchten moisture factor by changing the `hydraulics` model passed:
</code></pre><p>@example hydraulic<em>functions T = FT(0.0) θ</em>ice = FT(0.0)</p><p>K<em>bc =     Ksat .*     hydraulic</em>conductivity.(         Ref(impedance<em>choice),         Ref(viscosity</em>choice),         Ref(moisture<em>choice),         Ref(hydraulics</em>bc),         Ref(θ<em>ice),         Ref(ν),         Ref(T),         S</em>l,     ) plot(     S<em>l,     log10.(K),     xlabel = &quot;effective saturation&quot;,     ylabel = &quot;Log10(K)&quot;,     label = &quot;van Genuchten&quot;, ) plot!(     S</em>l,     log10.(K<em>bc),     xlabel = &quot;effective saturation&quot;,     ylabel = &quot;Log10(K)&quot;,     label = &quot;Brooks and Corey&quot;, ) savefig(&quot;./bc</em>vg_k.png&quot;)</p><pre><code class="language-none">
![](bc_vg_k.png)
# Other features
The user also has the choice of making the conductivity constant by choosing
`MoistureIndependent{FT}()`. This is useful for debugging!
</code></pre><p>@example hydraulic<em>functions no</em>moisture<em>dependence = MoistureIndependent{FT}() K</em>constant =     Ksat .*     hydraulic<em>conductivity.(         Ref(impedance</em>choice),         Ref(viscosity<em>choice),         Ref(no</em>moisture<em>dependence),         Ref(hydraulics),         Ref(θ</em>ice),         Ref(ν),         Ref(T),         S_l,     )</p><pre><code class="language-none"></code></pre><pre><code class="language-none">julia&gt; unique(K_constant)
1-element Array{Float32,1}:
 1.2277777f-5</code></pre><p>``` Note that choosing this option does not meant the matric potential is constant, as a hydraulics model is still required and employed.</p><p>And, lastly, you might be wondering why we left <code>Ksat</code> out of the function for <code>hydraulic_conductivity</code>. It turns out it is also useful for debugging to be able to turn off the diffusion of water, by setting <code>K_sat = 0</code>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Heat/heat_equation/">« Heat Equation</a><a class="docs-footer-nextpage" href="../../Heat/bonan_heat_tutorial/">Soil Heat Equation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 31 August 2020 15:46">Monday 31 August 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
